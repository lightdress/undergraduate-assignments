## 依赖

- MySQL 客户端

- MySQL 服务端

- MySQL C API (mysql/mysql.h)

## 配置

1. 已任意 MySQL 用户运行 Otto.sql ，建立用户 Otto ；

1. 已 Otto 运行 database.sql ，建立数据库 HHH ；

1. （可选）运行 examuser.sql 可导入 8 位用户；

1. （可选）运行 St_Floria.sql 可导入群组 St_Floria ；

## 方法

### 一级方法

链接建立后，可用的方法有：

1.
    C: SIGNUP <昵称> <密码>     #注册

    S: 
        
        - 403\n     #用户已存在
        - 200\n     #成功
        链接断开。

1.
    C: DW <昵称> <密码>         #下载文件

    S: 
        
        - 404\n     #用户不存在
        - 200\n     #成功

    C: <文件名>

    S: 
        
        - 404\n     #文件不存在
        - 200\n     #成功
        进入文件传输线程，传输完成后链接断开。

1.
    C: UP <昵称> <密码>         #上传文件

    S: 
        
        - 404\n     #用户不存在
        - 200\n     #成功

    C: <文件名>

    S: 
        
        - 502\n     #文件已存在
        - 200\n     #成功
        进入文件传输线程，传输完成后链接断开。

1.
    C: SIGNIN <昵称> <密码>     #登入

    S: 
        
        - 403\n     #用户已在线
        - 404\n     #用户不存在
        - 200\n     #成功
        进入二级方法，客户端掉线后链接断开。

### 二级方法

1. 
    C: ESTABLISH <群组名>                                  #建立群组

    S:

        - 403\n     #群组已存在
        - 400\n     #命令格式错误
        - 200\n     #成功

1. 

    C: JOIN GROUP <群组名>                                    #加入群组

    S:

        - 404\n     #群组不存在
        - 400\n     #命令格式错误
        - 200\n     #成功

1. 

    C: FETCH <USER|GROUP> <用户昵称|群组名>                    #获取历史消息

    S:

        - 404\n     #用户或群组不存在
        - 400\n     #命令格式错误
        - 404\n     #不属于该群组
        - 200\n     #成功，返回所有消息，按时间排序。
        消息格式：
            <发表时间> <类型> FROM <用户昵称>\n
            <内容>

1. 

    C: FORWARD <USER|GROUP> <用户昵称|群组名> <MSG|FILE>       #发消息

    S:

        - 404\n     #用户或群组或文件不存在
        - 400\n     #命令格式错误
        - 404\n     #不属于该群组
        - 200\n     #成功
        
    C: <内容> 

1. 

    C: POST <标题>                                            #发贴子

    S:

        - 403\n     #贴子已存在
        - 400\n     #命令格式错误
        - 200\n     #成功
        
    C: <内容>


1. 

    C: REPLY <贴子标题> <回复类型>                              #回复贴子

    S:
    
            - 404\n     #贴子不存在
            - 400\n     #命令格式错误
            - 200\n     #成功
            
    C: <回复内容>

1. 

    C: EXPLORE                                              #获取所有贴子

    S:

        - 200\n     #成功，返回所有贴子，按时间排序。
        贴子格式：
            <标题> FROM <用户昵称> AT <发表时间>\n
            <内容>


1. 

    C: GET <贴子标题>                                       #获取某贴子的所有回复

    S:

        - 404\n     #贴子不存在
        - 400\n     #命令格式错误
        - 200\n     #成功，返回所有回复，按时间排序。
        回复格式：
            FLLOR <楼数> <类型> FROM <用户昵称> AT <发表时间>\n
            <回复内容>
        
### 文件相关

- 回复和消息可包含文件，贴子内容不包含文件。

- 回复或消息 **类型** 为 FILE 表示文件，内容为文件名。

- 类型为文件的回复或消息发布前，需提前把文件用 UP 方法上传，否则返回 404 。
